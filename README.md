# Brewery-Review-Service

Created by Joel Attard, Shahyar Fida, Mike Kraemer, Julia Lebedzeva

This project is a Node.js microservice for managing product reviews in an e-commerce application, developed for Open Source Web Programming at Conestoga College. It supports adding reviews, fetching reviews by ID or product, updating reviews, deleting reviews, and listing all reviews, integrating with the Brewery Database Service via RESTful APIs. Built with TypeScript, Express, and Jest, it prioritizes security (JWT auth for user actions), robustness, and testability—targeting 90%+ branch coverage. It uses `dotenv-safe` to load environment variables from `.env.local` by default or based on `NODE_ENV`. Key settings include the server port (default: 3008), Brewery API URL (default: http://localhost:5089), and JWT secret. The `ReviewController` manages the logic, leveraging Axios for API calls and express-validator for input validation.

To get started, clone the repo from `C:\git\Brewery-Review-Service` (or your fork), then run `npm install` to install dependencies like `express`, `axios`, `jsonwebtoken`, `dotenv-safe`, and `express-validator`. For development, add `typescript`, `jest`, `@types/*` packages, and `ts-node` with `npm install --save-dev`. Set up a `.env.local` file with `PORT`, `JWT_SECRET`, `BREWERY_API_URL`, and `NODE_ENV`, using `.env.example` as a guide. Start the service with `npm start` (via `ts-node src/index.ts`), or compile with `npm run build` and run `node dist/index.js`. Run tests with `npm run test` to execute Jest with coverage—aiming for 100%.

The project structure includes `src/config/config.ts` for env setup, `src/controllers/reviewController.ts` for core logic, `src/middleware/auth.ts` for JWT verification, and `src/index.ts` to start the server. Tests would be in `src/config/__tests__/config.test.ts` and `src/controllers/__tests__/reviewController.test.ts`, mocking Axios and express-validator (not provided here). Below are the endpoints, all under `/review` with JSON content type. Routes with auth require a Bearer token in the `Authorization` header.

1. `POST /add-review` - Adds a review. Example input: `{"userId": 1, "productId": 1, "reviewRating": 4.5, "reviewMessage": "Great product!"}` with header `Authorization: Bearer <token>`. Success response (201): `{"Id": 1, "UserId": 1, "ProductId": 1, "ReviewRating": 4.5, "ReviewMessage": "Great product!"}`. Error (403): `{"message": "Unauthorized"}`.
2. `GET /:id` - Fetches a review by ID. Example request: `GET /review/1`. Success response (200): `{"Id": 1, "UserId": 1, "ReviewRating": 4.5}`. Error (404): `{"message": "Review not found"}`.
3. `PUT /:id` - Updates a review’s rating or message. Example input: `{"reviewRating": 5, "reviewMessage": "Even better now!"}` with header `Authorization: Bearer <token>`. Success response (200): `{"Id": 1, "ReviewRating": 5}`. Error (403): `{"message": "Unauthorized"}`.
4. `DELETE /:id` - Deletes a review. Example request: `DELETE /review/1`. Success response (200): `{"message": "Review deleted successfully"}`. Error (403): `{"message": "Unauthorized"}`.
5. `GET /` - Fetches all reviews. Example request: `GET /review`. Success response (200): `[{"Id": 1, "UserId": 1, "ReviewRating": 4.5}, ...]`. Error (500): `{"message": "Error fetching reviews"}`.
6. `GET /product/:productId` - Fetches reviews for a product. Example request: `GET /review/product/1`. Success response (200): `[{"Id": 1, "UserId": 1, "ReviewRating": 4.5}, ...]`. Error (500): `{"message": "Error fetching reviews"}`.
